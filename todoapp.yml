- name: SetUp TODOS APP Project
  hosts: all
  become: yes
  tasks:
    - name: Install NGINX
      apt:
        name: nginx
        update_cache: yes
        state: present

    - name: Download Artifacts from Nexus
      get_url:
        url: http://172.31.11.166:8081/repository/frontend/frontend-{{APP_VERSION}}.zip
        dest: /var/www/html
        username: admin 
        password: admin123

    - name: Unzip the Downloaded Content
      unarchive:
          src: /var/www/html/frontend-0.0.7.zip
          dest: /var/www/html
          remote_src: yes


    - name: Replace content
      replace:
        path: /etc/nginx/sites-enabled/default
        regexp: '/var/www/html'
        replace: '/var/www/html/frontend/dist'

    - name: Start Nginx
      systemd:
        state: started
        name: nginx
        enabled: yes
